# Функции таблицы лута и торговли

И таблицы лута, и таблицы торговли имеют одинаковый набор функций. Хотя большинство из них работают в обоих типах,
некоторые работают только в определенном типе. Существуют ограничения для таблиц лута/торговли в целом: например, нет
возможности добавить can_place_on или can_destroy к предмету через таблицы лута или торговли. Ниже приведены различные
доступные функции и пример их использования.

В этом руководстве вы узнаете следующее:

+ Различные функции таблиц награбленного и торговли и то, как они могут изменять предмет.

### Требования

Перед началом этого урока рекомендуется пройти следующее.

+ [Введение в таблицы лута](Introduction_to_Loot_Tables.md)

## Зачарование

Эти различные функции зачарования позволяют задать уникальные параметры зачарования.

### enchant_book_for_trading (только для торгового стола)

Эта функция зачаровывает книгу, используя алгоритм зачарования предметов, продаваемых деревенскими жителями. Она
принимает четыре параметра: `base_cost`, `base_random_cost`, `per_level_random_cost`, и `per_level_cost`.

``` json
{
    "item": "minecraft:book",
    "quantity": 1,
    "functions": [
        {
            "function": "enchant_book_for_trading",
            "base_cost": 2,
            "base_random_cost": 5,
            "per_level_random_cost": 10,
            "per_level_cost": 3
        }
    ]
}
```

В настоящее время определение этих параметров не влияет на получаемые чары. В настоящее время приведенные выше значения
по умолчанию жестко закодированы. В будущем вы сможете изменить эти значения, чтобы определить, какие зачарования и
уровни зачарований дает эта функция.

### enchant_random_gear

Зачаровывает предмет, используя тот же алгоритм, что и при зачаровании экипировки, с которой спаунятся ванильные мобы.
Для управления алгоритмом берется модификатор `chance`. Обратите внимание, что модификатор `chance` 1.0 не означает 100%
вероятность того, что предмет будет зачарован. Скорее, шанс изменяется в зависимости от сложности. На мирной и легкой
сложности шанс всегда будет равен 0%, независимо от того, что происходит. На сложности Hard `chance` 1.0 будет равен
100%, но этот шанс примерно равен 2/3 шанса на сложности Normal.

``` json
{
    "type": "item",
    "name": "minecraft:chainmail_boots",
    "weight": 1,
    "functions": [
      {
        "function": "enchant_random_gear",
        "chance": 0.25
      }
    ]
}
```

Увеличение `chance` до числа, превышающего 1,0, поможет обойти снижение шанса на Нормальной сложности. Например, если
установить `chance` на 2,0, предмет всегда будет зачаровываться как на Нормальной, так и на Трудной сложности.

### enchant_randomly

Генерирует случайное зачарование, совместимое с данным предметом. Поддерживает необязательный `boolean` treasure (
true/false), позволяющий включать и выключать зачарования сокровищ. Зачарования сокровищ - это зачарования, которые
нельзя получить через таблицу зачарования, включая Ледоход, Починка, Скорость души, Проклятие привязки и Проклятие
исчезновения.

``` json
{
    "type": "item",
    "name": "minecraft:leather_helmet",
    "weight": 1,
    "functions": [
      {
        "function": "enchant_randomly",
        "treasure": true
      }
    ]
}
```

### enchant_with_levels

Накладывает чары, как если бы они были зачарованы с помощью таблицы зачарования, используя минимальный и максимальный
уровень XP, определяемый параметром `levels`. Булево `treasure` (true/false) позволяет использовать чары,
предназначенные только для сокровищ. Зачарования сокровищ - это зачарования, которые нельзя получить через таблицу
зачарования, включая Ледоход, Починка, Скорость души, Проклятие привязки и Проклятие исчезновения.

``` json
{
    "type": "item",
    "name": "minecraft:diamond_sword",
    "weight": 1,
    "functions": [
      {
        "function": "enchant_with_levels",
        "treasure": true,
        "levels": {
          "min": 20,
          "max": 39
        }
      }
    ]
}
```

### specific_enchants

Эта функция позволяет установить список определенных зачарований на предмет. Она также позволяет накладывать чары на
предметы, которые обычно не могут быть зачарованы в игре.

``` json
{
    "type": "item",
    "name": "minecraft:stick",
    "weight": 1,
    "functions": [
        {
          "function": "specific_enchants",
          "enchants": [
             "knockback",
             "fire_aspect"
          ]
       }
    ]
}
```

Вы также можете задать зачарования как объекты, чтобы определить уровень зачарования. Максимальные уровни зачарований
жестко закодированы и не могут быть перезаписаны.

``` json
{
    "type": "item",
    "name": "minecraft:stick",
    "weight": 1,
    "functions": [
        {
          "function": "specific_enchants",
          "enchants": [
             {
                "id": "knockback",
                "level": 1
             },
             {
                "id": "unbreaking",
                "level": 3
             }
          ]
       }
    ]
}
```

## Модификация предметов

Следующий набор функций позволяет изменять результаты различными способами, например, задавать количество возвращаемых
предметов, значение данных или даже название и историю предмета.

### looting_enchant (только для таблицы лута).

Эта функция позволяет изменить подсчет количества возвращаемых предметов при убийстве существа предметом с зачарованием
грабежа. Из-за этого она работает только с таблицами награбленного, и только если эта таблица награбленного вызывается
при смерти существа.

### random_block_state

Это позволяет рандомизировать состояние блока получаемого предмета. Например, следующий пример кода может выпасть
камень (0), гранит (1), полированный гранит (2), диорит (3), полированный диорит (4) или андезит (5).

``` json
{
    "type": "item",
    "name": "minecraft:stone",
    "weight": 1,
    "functions": [
        {
          "function": "random_block_state",
          "block_state": "stone_type",
          "values": {
            "min": 0,
            "max": 5
          }
        }
      ]
}
```

### random_aux_value

Аналогично `random_block_state`, позволяет выбрать случайное вспомогательное значение для элемента. Следующий пример
приведет к случайному цвету красителя.

``` json
{
    "type": "item",
    "name": "minecraft:dye",
    "weight": 1,
    "functions": [
        {
          "function": "random_aux_value",
          "values": {
            "min": 0,
            "max": 15
          }
        }
    ]
}
```

### set_actor_id

Эта функция работает только с яйцом спауна и используется для установки идентификатора сущности этого яйца спауна.

``` json
{
    "type": "item",
    "name": "minecraft:stone",
    "weight": 1,
    "functions": [
        {
            "function": "set_actor_id",
            "id": "compass:cool_entity"
        }
    ]
}
```

Вы также можете унаследовать идентификатор сущности, связанной с этим столом добычи (например, заставить кролика выпасть
из яйца спавна кролика), опустив `id`.

``` json
{
    "type": "item",
    "name": "minecraft:spawn_egg",
    "weight": 1,
    "functions": [
        {
            "function": "set_actor_id"
        }
    ]
}
```

Имейте в виду, что если вы используете `set_actor_id` для таблицы лута сундука и опустите значение id, то будет создано
яйцо спавна того, кто откроет сундук (игрока). Яйцо порождения игрока породит "игрока", который просто стоит и
выбрасывает ошибки MoLang (поскольку он пытается использовать файл поведения игрока, а также контроллеры игрока). Если
разбить сундук, содержащий таблицу лута, которая использует унаследованный id от `set_actor_id`, то выпадет яйцо спавна
по умолчанию, которое ничего не спавнит.

### set_banner_details

Эта функция работает только с баннерами и в настоящее время поддерживает только баннер `type`, равный `1`. Баннер `type`
в `1` приводит к появлению Зловещего баннера.

``` json
{
    "type": "item",
    "name": "minecraft:banner",
    "weight": 1,
    "functions": [
        {
            "function": "set_banner_details",
            "type": 1
        }
    ]
}
```

### set_book_contents

Эта функция позволяет установить содержимое книги.

``` json
{
    "type": "item",
    "name": "minecraft:written_book",
    "functions": [
        {
            "function": "set_book_contents",
            "author": "Steve",
            "title": "Creator Woes",
            "pages": [
                "Once upon a time there were some marketplace partners that had to edit items using NBT. And it made them sad.",
                "Then the Bedrock team added the ability to customize items from JSON and everyone rejoiced."
            ]
        }
    ]
}
```

Вы также можете использовать `rawtext` для локализации содержимого книги. При использовании `rawtext` не забывайте
всегда экранировать (`\ `) специальные символы, такие как `"` и `\`.

Помните, что на момент написания этой статьи вы можете использовать `rawtext` только для содержимого книги
(`pages`) - `rawtext` **не** работает для тегов `author` или `title`.

``` json
{
    "type": "item",
    "name": "minecraft:written_book",
    "functions": [
        {
            "function": "set_book_contents",
            "author": "Steve",
            "title": "Creator Woes",
            "pages": [
                "{\"rawtext\":[ {\"translate\":\"custom.book.page.1\"}]}",
                "{\"rawtext\":[ {\"translate\":\"custom.book.page.2\"}]}"
            ]
        }
    ]
}
```

### set_count

Устанавливает количество элементов, возвращаемых при установке значения `count`. Это может быть либо точное число, как в
этом примере:

``` json
{
    "type": "item",
    "name": "minecraft:stone",
    "weight": 1,
    "functions": [
        {
          "function": "set_count",
          "count": 5
        }
    ]
}
```

Или оно может быть в диапазоне min/max:

``` json
{
    "type": "item",
    "name": "minecraft:stone",
    "weight": 1,
    "functions": [
        {
          "function": "set_count",
          "count": {
            "min": 1,
            "max": 6
          }
        }
    ]
}
```

### set_damage

Устанавливает процент оставшейся прочности для предметов, которые имеют прочность при установке значения `damage`. 1.0 -
это 100% оставшейся прочности (неповрежденной), а 0.0 - отсутствие прочности.

``` json
{
    "type": "item",
    "name": "minecraft:iron_leggings",
    "weight": 1,
    "functions": [
      {
        "function": "set_damage",
        "damage": 0.5
      }
    ]
}
```

Вы можете установить точное значение долговечности, как в следующем примере, где мы установили, что у предмета осталось
50% долговечности. Или вы можете задать минимальное/максимальное значение, которое игра будет выбирать случайным
образом. В следующем примере долговечность установлена где-то между 30% и 90%.

``` json
{
    "type": "item",
    "name": "minecraft:iron_leggings",
    "weight": 1,
    "functions": [
      {
        "function": "set_damage",
        "damage": {
          "min": 0.3,
          "max": 0.9
        }
      }
    ]
}
```

### set_data

Устанавливает значение данных блока или элемента на точный идентификатор. В следующем примере будет создан блок
полированного диорита.

``` json
{
    "type": "item",
    "name": "minecraft:stone",
    "functions": [
        {
            "function": "set_data",
            "data": 4
        }
    ]
}
```

### set_data_from_color_index

Наследует значение данных результирующего элемента от индекса цвета связанной сущности. Игровым примером может быть
розовая овца, сбрасывающая розовую шерсть после смерти. Если у связанной сущности не задан индекс цвета (или она
используется в таблице награбленного в сундуке), значение данных всегда будет равно 0.

``` json
{
    "type": "item",
    "name": "minecraft:wool",
    "weight": 1,
    "functions": [
        {
            "function": "set_data_from_color_index"
        }
    ]
}
```

### set_lore

Эта функция позволяет задать историю предмета. Каждая строка в объекте lore представляет собой одну строку текста. В
настоящее время нет поддержки для `rawtext`.

``` json
{
    "type": "item",
    "name": "minecraft:stick",
    "weight": 1,
    "functions": [
        {
            "function": "set_lore",
            "lore": [
                "Big Stick has been handed down",
                "for generations from King to Prince",
                "until it went missing four score ago"
            ]
       }
    ]
}
```

### set_name

Эта функция позволяет задать имя элемента. В настоящее время нет поддержки для `rawtext`.

``` json
{
    "type": "item",
    "name": "minecraft:stick",
    "weight": 1,
    "functions": [
        {
            "function": "set_name",
            "name": "Big Stick"
        }
    ]
}
```

## Разное

Ниже приведены функции, которые не помещаются в других местах.

### fill_container

Эта функция позволяет определить таблицу лута для сундука. Когда предмет будет сгенерирован и игрок поместит его, он
будет заполнен содержимым, определенным в указанной таблице лута.

Таблицы лута для сундуков генерируются во время открытия или поломки. Считайте, что это ящик Шредингера. Содержимое
сундука не определено, пока вы не заглянете внутрь.

``` json
{
      "type": "item",
      "name": "minecraft:chest",
      "functions": [
          {
              "function": "fill_container",
              "loot_table": "loot_tables/chests/simple_dungeon.json"
          }
      ]
}
```

Рекомендуется всегда использовать `set_name`, чтобы дать сундуку имя при использовании `fill_container`. Если этого не
сделать, то полученный сундук не будет выглядеть в инвентаре игрока иначе, чем обычный пустой сундук.

### exploration_map

Преобразует обычную карту в карту сокровищ, на которой отмечено местоположение спрятанных сокровищ. Значение назначения
определяет тип получаемой карты сокровищ.

``` json
{
      "type": "item",
      "name": "minecraft:map",
      "weight": 1,
      "functions": [
          {
              "function": "exploration_map",
              "destination": "buriedtreasure"
          }
      ]
}
```

В настоящее время вы можете выбрать одно из следующих направлений:

Место назначения:

+ endcity
+ fortress
+ mineshaft
+ monument
+ ruins
+ stronghold
+ village
+ mansion
+ shipwreck
+ buriedtreasure
+ pillageroutpost

### furnace_smelt (только для таблицы лута).

Если возвращаемый предмет имеет рецепт переплавки и таблица лута вызвана существом, убитым огнем (Облик огня, зажигалка,
лава и т.д.), результатом будет переплавленная версия предмета. Из-за этих требований данная функция не работает при
торговле с деревенскими жителями или с сундуками. Эта функция работает только в сочетании с поведением `minecraft:loot`.

В следующем примере из предмета выпадет каменный блок, если он погиб от огня, или булыжник, если нет.

``` json
{
    "type": "item",
    "name": "minecraft:cobblestone",
    "weight": 1,
    "functions": [
        {
            "function": "furnace_smelt"
        }
    ]
}
```
